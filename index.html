<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Duck Racing â€” Full View</title>

<style>
body{margin:0;background:#0f172a;color:#fff;font-family:system-ui;display:flex;justify-content:center;min-height:100vh}
.container{max-width:1000px;width:100%;padding:10px;display:flex;flex-direction:column;box-sizing:border-box}
.card{background:#111827;border-radius:16px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.5);border:1px solid #1f2937}

h2{text-align:center;color:#38bdf8;margin:0 0 10px 0}
textarea{width:100%;height:80px;border-radius:8px;border:1px solid #334155;background:#020617;color:#fff;padding:10px;box-sizing:border-box;font-size: 14px;}

.buttons{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:10px 0}
button{padding:12px;border-radius:8px;border:none;font-weight:700;cursor:pointer;transition: 0.2s; font-size: 14px;}
#startBtn{background:#22c55e;color:#000}
#resetBtn{background:#38bdf8;color:#000}
button:active{transform: scale(0.96);}

.timer{font-size:22px;text-align:center;color:#fbbf24;font-weight:bold;margin-bottom:10px; font-variant-numeric: tabular-nums;}
.commentary-box{background:#1e1b4b;color:#e0e7ff;padding:12px;border-radius:8px;font-size:14px;border:1px solid #4338ca;min-height:22px;margin-bottom:15px; text-align: center;}

/* ÄÆ¯á»œNG ÄUA - ÄÃƒ FIX HIá»‚N THá»Š TOÃ€N Bá»˜ */
.track-wrapper {
  width: 100%;
  overflow-x: auto; /* Chá»‰ cho phÃ©p cuá»™n ngang */
  overflow-y: hidden; /* Tuyá»‡t Ä‘á»‘i khÃ´ng cuá»™n dá»c */
  background:#020617;
  border:1px solid #1e293b;
  border-radius:12px;
  position: relative;
}
.track {
  position:relative;
  width: 4500px; /* Äá»™ dÃ i Ä‘Æ°á»ng Ä‘ua */
  background-image: linear-gradient(90deg, #1e293b 1px, transparent 1px);
  background-size: 300px 100%;
  padding: 10px 0;
  transition: height 0.3s ease; /* Co giÃ£n mÆ°á»£t mÃ  khi thÃªm vá»‹t */
}
.finish-line {
  position:absolute;
  right:100px;
  top:0; bottom:0;
  width:20px;
  background: repeating-linear-gradient(45deg, #ef4444, #ef4444 8px, #fff 8px, #fff 16px);
  border-left: 4px solid white;
}

/* CON Vá»ŠT */
.duck {
  position: absolute;
  left: 0;
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 600;
  white-space: nowrap;
  height: 40px; /* Chiá»u cao cá»‘ Ä‘á»‹nh má»—i lÃ n */
  padding: 0 10px;
  border-radius: 20px;
  transition: background 0.3s;
}
.duck:hover { background: rgba(255,255,255,0.05); }

.duck-icon {
  font-size: 26px;
  display: inline-block;
  transition: transform 0.2s;
}

/* HIá»†U á»¨NG */
.duck.boosted .duck-icon {
  filter: drop-shadow(0 0 12px #fbbf24);
  transform: scale(1.4) rotate(-15deg);
}
.duck.stunned { opacity: 0.4; filter: grayscale(1); }
.duck.stunned .duck-icon { transform: rotate(180deg); }

/* Báº¢NG Xáº¾P Háº NG */
#board { padding:0; list-style:none; margin-top: 20px;}
#board li {
  background:#1e293b; padding:12px 16px; margin-bottom:6px;
  border-radius:10px; display:flex; justify-content:space-between;
  border: 1px solid #334155;
  animation: slideIn 0.3s ease-out;
}
@keyframes slideIn { from{opacity:0; transform:translateX(-10px)} to{opacity:1; transform:translateX(0)} }
.top1 { background: linear-gradient(90deg, #fde047, #facc15) !important; color: #000; border:none !important; font-weight: 800;}
</style>
</head>

<body>
<div class="container">
  <div class="card">
    <h2>ğŸ¤ Duck Racing Pro</h2>
    <textarea id="names" placeholder="Vá»‹t A&#10;Vá»‹t B...">Vá»‹t VÃ ng&#10;Vá»‹t Xanh&#10;Vá»‹t Äá»&#10;Vá»‹t TÃ­m&#10;Vá»‹t Cam</textarea>
    
    <div class="buttons">
      <button id="startBtn">ğŸ Báº®T Äáº¦U</button>
      <button id="resetBtn">ğŸ”„ LÃ€M Má»šI</button>
    </div>

    <div class="timer" id="timer">â± 0.00s</div>
    <div class="commentary-box" id="commentary">ğŸ“¢ Há»‡ thá»‘ng sáºµn sÃ ng!</div>

    <div class="track-wrapper" id="scrollContainer">
      <div class="track" id="track">
        <div class="finish-line"></div>
      </div>
    </div>

    <h3>ğŸ† Káº¿t quáº£</h3>
    <ul id="board"></ul>
  </div>
</div>

<script>
const track = document.getElementById('track');
const scrollContainer = document.getElementById('scrollContainer');
const commentaryEl = document.getElementById('commentary');
const board = document.getElementById('board');
const timerEl = document.getElementById('timer');

let ducks = [], results = [], running = false, startTime = 0;
let msgQueue = [], isAnnouncing = false;

function log(msg) {
    msgQueue.push(msg);
    if(!isAnnouncing) showNextMsg();
}

function showNextMsg() {
    if(msgQueue.length === 0) { isAnnouncing = false; return; }
    isAnnouncing = true;
    commentaryEl.innerHTML = `ğŸ“¢ <b>${msgQueue.shift()}</b>`;
    setTimeout(() => showNextMsg(), 1600);
}

function reset() {
    running = false;
    results = [];
    board.innerHTML = "";
    timerEl.textContent = "â± 0.00s";
    msgQueue = [];
    isAnnouncing = false;
    commentaryEl.textContent = "ğŸ“¢ Sáºµn sÃ ng Ä‘ua!";
    scrollContainer.scrollLeft = 0;
    track.querySelectorAll('.duck').forEach(d => d.remove());
}

function startRace() {
    if(running) return;
    const names = document.getElementById('names').value.split('\n').map(s => s.trim()).filter(Boolean);
    if(names.length === 0) return;
    
    reset();

    // CHIá»€U CAO Tá»° Äá»˜NG: Má»—i con vá»‹t chiáº¿m 45px chiá»u cao
    const duckHeight = 45;
    track.style.height = (names.length * duckHeight + 20) + "px";

    ducks = names.map((name, i) => {
        const d = document.createElement('div');
        d.className = 'duck';
        const icons = ['ğŸ¦†', 'ğŸ¤', 'ğŸ§', 'ğŸ¦', 'ğŸ¥', 'ğŸ¦…', 'ğŸ¦¢'];
        const randomIcon = icons[i % icons.length];
        
        d.innerHTML = `<span class="duck-icon">${randomIcon}</span> <span>${name}</span>`;
        d.style.top = (i * duckHeight + 10) + "px";
        
        d.dataset.x = 0;
        d.dataset.name = name;
        d.dataset.status = "run";
        d.dataset.statusTimer = 0;
        d.dataset.cooldown = 0; // Há»“i chiÃªu bá»©t tá»‘c
        d.dataset.done = "0";
        
        track.appendChild(d);
        return d;
    });

    running = true;
    startTime = performance.now();
    requestAnimationFrame(update);
}

function update() {
    if(!running) return;

    const now = performance.now();
    const elapsed = ((now - startTime) / 1000).toFixed(2);
    timerEl.textContent = "â± " + elapsed + "s";

    let leadingX = 0;
    let finishedCount = 0;
    const finishX = track.offsetWidth - 150;

    ducks.forEach(d => {
        if(d.dataset.done === "1") {
            finishedCount++;
            return;
        }

        let x = parseFloat(d.dataset.x);
        let sTimer = parseInt(d.dataset.statusTimer);
        let cooldown = parseInt(d.dataset.cooldown);

        if(sTimer > 0) d.dataset.statusTimer = sTimer - 1;
        if(cooldown > 0) d.dataset.cooldown = cooldown - 1;

        if(sTimer === 0 && d.dataset.status !== "run") {
            d.dataset.status = "run";
            d.classList.remove('boosted', 'stunned');
        }

        let speed = 2.2 + Math.random() * 1.8; 
        if(d.dataset.status === "boost") speed += 6; 
        if(d.dataset.status === "stun") speed = 0;

        // LOGIC Bá»¨T Tá»C & Há»’I CHIÃŠU
        if(d.dataset.status === "run" && parseInt(d.dataset.cooldown) === 0 && Math.random() < 0.006) {
            const dice = Math.random();
            if(dice > 0.6) {
                d.dataset.status = "boost";
                d.dataset.statusTimer = 110; 
                d.dataset.cooldown = 450; // Chá» 7-8 giÃ¢y má»›i Ä‘Æ°á»£c bá»©t tá»‘c láº¡i
                d.classList.add('boosted');
                log(d.dataset.name + " Ä‘ang bá»©c tá»‘c cá»±c cÄƒng!");
            } else if (dice < 0.15) {
                d.dataset.status = "stun";
                d.dataset.statusTimer = 50; 
                d.dataset.cooldown = 120;
                d.classList.add('stunned');
                log(d.dataset.name + " vá»«a bá»‹ váº¥p chÃ¢n!");
            }
        }

        x += speed;
        d.dataset.x = x;
        d.style.left = x + "px";

        if(x > leadingX) leadingX = x;

        if(x >= finishX) {
            d.dataset.done = "1";
            d.style.left = finishX + "px";
            results.push({name: d.dataset.name, time: elapsed});
            log(d.dataset.name + " ÄÃƒ Vá»€ ÄÃCH!");
            updateBoard();
        }
    });

    const screenW = scrollContainer.offsetWidth;
    if(leadingX > screenW / 2.5) {
        scrollContainer.scrollLeft = leadingX - screenW / 2.5;
    }

    if(finishedCount < ducks.length) {
        requestAnimationFrame(update);
    } else {
        running = false;
        log("Háº¾T GIá»œ! CUá»˜C ÄUA Káº¾T THÃšC.");
    }
}

function updateBoard() {
    board.innerHTML = results.map((r, i) => 
        `<li class="${i===0?'top1':''}">
            <span><b>#${i+1}</b> ${r.name}</span> 
            <span>${r.time}s</span>
        </li>`
    ).join('');
}

document.getElementById('startBtn').onclick = startRace;
document.getElementById('resetBtn').onclick = reset;
</script>
</body>
</html>
